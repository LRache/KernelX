ARCH ?= riscv
TARGET ?= riscv64-linux-gnu

CMAKE_DEFINITIONS += ARCH=$(ARCH)
CMAKE_DEFINITIONS += ARCH_BITS=$(ARCH_BITS)
CMAKE_DEFINITIONS += TARGET=${TARGET}
CMAKE_DEFINITIONS += CMAKE_BUILD_TYPE=Release
CMAKE_DEFINITIONS += KERNELX_HOME=$(KERNELX_HOME)
CMAKE_DEFINITIONS += CROSS_COMPILE=$(CROSS_COMPILE)
CMAKE_DEFINITIONS += CMAKE_EXPORT_COMPILE_COMMANDS=1
CMAKE_FLAGS += $(addprefix -D, $(CMAKE_DEFINITIONS))

BUILD_DIR = build/$(ARCH)$(ARCH_BITS)

all:
	@ mkdir -p $(BUILD_DIR)
	@ cmake -B $(BUILD_DIR) $(CMAKE_FLAGS)
	@ cmake --build $(BUILD_DIR)

clean:
	@ rm -rf $(BUILD_DIR)
