ARCH ?= riscv
TARGET ?= riscv64-linux-gnu
TOOLCHAIN_FILE = cmake/toolchain/$(ARCH)$(ARCH_BITS).cmake

CMAKE_DEFINITIONS += ARCH=$(ARCH)
CMAKE_DEFINITIONS += ARCH_BITS=$(ARCH_BITS)
CMAKE_DEFINITIONS += KERNELX_HOME=$(KERNELX_HOME)
CMAKE_DEFINITIONS += CROSS_COMPILE=$(CROSS_COMPILE)
CMAKE_DEFINITIONS += CMAKE_BUILD_TYPE=$(COMPILE_MODE)
CMAKE_DEFINITIONS += CMAKE_TOOLCHAIN_FILE=$(TOOLCHAIN_FILE)
CMAKE_DEFINITIONS += CMAKE_EXPORT_COMPILE_COMMANDS=1
CMAKE_FLAGS += $(addprefix -D, $(CMAKE_DEFINITIONS))

BUILD_DIR = build/$(ARCH)$(ARCH_BITS)

all:
	@ mkdir -p $(BUILD_DIR)
	cmake -B $(BUILD_DIR) $(CMAKE_FLAGS)
	@ cmake --build $(BUILD_DIR)

clean:
	@ rm -rf $(BUILD_DIR)
