ARCH ?= riscv
PLATFORM ?= qemu-virt-riscv64
TARGET ?= riscv64-linux-gnu

TOOLCHAINE_FILE = cmake/toolchain/$(PLATFORM).cmake

CMAKE_DEFINITIONS += ARCH=$(ARCH)
CMAKE_DEFINITIONS += ARCH_BITS=$(ARCH_BITS)
CMAKE_DEFINITIONS += PLATFORM=$(PLATFORM)
CMAKE_DEFINITIONS += TARGET=${TARGET}
CMAKE_DEFINITIONS += CMAKE_BUILD_TYPE=Release
CMAKE_DEFINITIONS += CMAKE_TOOLCHAIN_FILE=$(TOOLCHAINE_FILE)
CMAKE_DEFINITIONS += KERNELX_HOME=$(KERNELX_HOME)
CMAKE_DEFINITIONS += CMAKE_EXPORT_COMPILE_COMMANDS=1
CMAKE_FLAGS += $(addprefix -D, $(CMAKE_DEFINITIONS))

BUILD_DIR = build/$(ARCH)$(ARCH_BITS)

all:
	@ mkdir -p $(BUILD_DIR)
	@ cmake -B $(BUILD_DIR) $(CMAKE_FLAGS)
	@ cmake --build $(BUILD_DIR)

clean:
	@ cmake --build $(BUILD_DIR) --target clean
